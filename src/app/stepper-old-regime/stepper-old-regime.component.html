<form [formGroup]="taxForm">
    <mat-stepper class="example-stepper" (selectionChange)="checkStep($event)"
        [orientation]="(stepperOrientation | async)!" color="primary">
        <mat-step label="Income Details">
            <mat-card>
                <mat-card-content>
                    <div class="">
                        <p class="font-bold">Gross Annual Income/Salary </p>
                        <p>With all allowances</p>
                    </div>
                    <mat-form-field subscriptSizing="dynamic" appearance="outline" class="dense-5">
                        <input type="number" formControlName="salaryIncome" matInput placeholder="Salary" required>
                        <span matTextPrefix>₹&nbsp;</span>
                    </mat-form-field>
                    <div class="grid grid-cols-12">
                        <p class="col-span-4 font-bold">Do you have other sources of
                            Income</p>
                        <mat-slide-toggle formControlName="isOtherIncome" labelPosition="before"></mat-slide-toggle>
                    </div>
                    <br>
                    <div [ngClass]="{'disabled': !taxForm.get('isOtherIncome')?.value}">
                        <div class="grid grid-cols-2">
                            <div class="flex flex-col  mb-2 pr-2">
                                <div class="">
                                    <p class="font-bold">Income from Interest
                                    </p>
                                    <p>
                                        From Bank accounts, NSC, and Post Office MIS.
                                    </p>
                                </div>
                                <div class="flex items-center dense-5">
                                    <mat-form-field subscriptSizing="dynamic" appearance="outline">
                                        <input type="number" matInput formControlName="incomeFromInterest"
                                            placeholder="Income from Interest">
                                        <span matTextPrefix>₹&nbsp;</span>
                                    </mat-form-field>
                                </div>
                            </div>
                            <div class="flex flex-col mb-2 pl-2">
                                <div class="">
                                    <p class="font-bold">
                                        Rental Income (Annual)
                                    </p>
                                    <p>
                                        From let out properties, after deducting Municipal taxes.
                                    </p>
                                </div>
                                <div class="flex items-center dense-5">
                                    <mat-form-field subscriptSizing="dynamic" appearance="outline">
                                        <input type="number" matInput formControlName="rentalIncome" placeholder="Rental Income">
                                        <span matTextPrefix>₹&nbsp;</span>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2">
                            <div class="flex flex-col  mb-2 pr-2">
                                <div class="">
                                    <p class="font-bold">
                                        Short Term Capital Gains
                                    </p>

                                </div>
                                <div class="flex items-center dense-5">
                                    <mat-form-field subscriptSizing="dynamic" appearance="outline">
                                        <input type="number" matInput formControlName="longTermCapitalgain"
                                            placeholder="Long Term Gain">
                                        <span matTextPrefix>₹&nbsp;</span>
                                    </mat-form-field>
                                </div>
                            </div>
                            <div class="flex flex-col mb-2 pl-2">
                                <div class="">
                                    <p class="font-bold">
                                        Long Term Capital Gains
                                    </p>

                                </div>
                                <div class="flex items-center dense-5">
                                    <mat-form-field subscriptSizing="dynamic" appearance="outline">
                                        <input type="number" formControlName="shortTermCapitalgain" matInput
                                            placeholder="Short Term Gain">
                                        <span matTextPrefix>₹&nbsp;</span>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2">
                            <div class="flex flex-col  mb-2 pr-2">
                                <div class="">
                                    <p class="font-bold">Other Income
                                    </p>
                                    <p>
                                        Business Income, Commissions, etc.
                                    </p>
                                </div>
                                <div class="flex items-center dense-5">
                                    <mat-form-field subscriptSizing="dynamic" appearance="outline">
                                        <input type="number" matInput formControlName="otherIncome" placeholder="Other Income">
                                        <span matTextPrefix>₹&nbsp;</span>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                    </div>

                    <br>
                    <div class="flex justify-end">
                        <button mat-raised-button matStepperNext color="primary">Next</button>
                    </div>
                </mat-card-content>
            </mat-card>
        </mat-step>
        <mat-step label="HRA">
            <mat-card>
                <mat-card-content>
                    <div class="">
                        <p class="font-bold">House rent allowance (HRA) </p>
                    </div>
                    <div>
                        <mat-chip-listbox aria-label="City of Residence" formControlName="cityOfResidence">
                            <mat-chip-option value="metro">Metro</mat-chip-option>
                            <mat-chip-option value="non-metro">Non-Metro</mat-chip-option>
                        </mat-chip-listbox>
                    </div>
                    <br>
                    <div class="flex flex-col">
                        <div class="flex flex-col  mb-2 pr-2">
                            <div class="">
                                <p class="font-bold">Basic Salary - Annual
                                </p>
                            </div>
                            <div class="flex items-center dense-5">
                                <mat-form-field subscriptSizing="dynamic" appearance="outline">
                                    <input type="number" matInput formControlName="basicSalary" placeholder="Basic Salary">
                                    <span matTextPrefix>₹&nbsp;</span>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="flex flex-col  mb-2 pr-2">
                            <div class="">
                                <p class="font-bold">
                                    Rent Paid - Annual
                                </p>

                            </div>
                            <div class="flex items-center dense-5">
                                <mat-form-field subscriptSizing="dynamic" appearance="outline">
                                    <input type="number" formControlName="rentPaid" matInput placeholder="Rent">
                                    <span matTextPrefix>₹&nbsp;</span>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="flex flex-col mb-2">
                            <div class="">
                                <p class="font-bold">
                                    HRA received from Employer
                                </p>

                            </div>
                            <div class="flex items-center dense-5">
                                <mat-form-field subscriptSizing="dynamic" appearance="outline">
                                    <input type="number" formControlName="hraReceived" matInput placeholder="HRA received">
                                    <span matTextPrefix>₹&nbsp;</span>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                    <br>
                    <div class="flex justify-end">
                        <button mat-raised-button matStepperPrevious color="accent" class="mr-4">Back</button>
                        <button mat-raised-button matStepperNext color="primary">Next</button>
                    </div>
                </mat-card-content>
            </mat-card>

        </mat-step>
        <mat-step label="Deductions">
            <mat-card>
                <mat-card-content>
                    <div class="grid grid-cols-2">
                        <div class="flex flex-col  mb-2 pr-2">
                            <div class="">
                                <p class="font-bold">
                                    Total Investment
                                </p>
                                <p>
                                    (LIC, PF, EPF, ELSS funds, etc.)
                                </p>
                            </div>
                            <div class="flex items-center dense-5">
                                <mat-form-field subscriptSizing="dynamic" appearance="outline">
                                    <input type="number" formControlName="investment" matInput placeholder="Investment">
                                    <span matTextPrefix>₹&nbsp;</span>
                                    <mat-hint>Max - ₹ 1,50,000</mat-hint>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="flex flex-col  mb-2 pr-2">
                            <div class="">
                                <p class="font-bold">
                                    Home Loan Interest Payment
                                </p>
                                <p>
                                    (Interest part) - Annual
                                </p>
                            </div>
                            <div class="flex items-center dense-5">
                                <mat-form-field subscriptSizing="dynamic" appearance="outline">
                                    <input type="number" formControlName="houseLoanInterest" matInput
                                        placeholder="Home Loan Interest">
                                    <span matTextPrefix>₹&nbsp;</span>
                                    <mat-hint>Max - ₹ 2,00,000</mat-hint>

                                </mat-form-field>
                            </div>
                        </div>

                    </div>
                    <br>
                    <div class="grid grid-cols-2">
                        <div class="flex flex-col  mb-2 pr-2">
                            <div class="">
                                <p class="font-bold">
                                    NPS - Paid By Employer
                                </p>
                                <p>
                                    Central Govt - upto 14%, Others - upto 10%
                                </p>
                            </div>
                            <div class="flex items-center dense-5">
                                <mat-form-field subscriptSizing="dynamic" appearance="outline">
                                    <input type="number" formControlName="npsEmployerContribution" matInput
                                        placeholder="NPS by Employer">
                                    <span matTextPrefix>₹&nbsp;</span>
                                    <mat-hint>Govt-₹{{calculateMaxNpsAllowed(14)}}
                                        Others-₹{{calculateMaxNpsAllowed(10)}}</mat-hint>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="flex flex-col  mb-2 pr-2">
                            <div class="">
                                <p class="font-bold">
                                    NPS - Voluntary Contribution
                                </p>
                                <p>
                                    Own Contribution
                                </p>
                            </div>
                            <div class="flex items-center dense-5">
                                <mat-form-field subscriptSizing="dynamic" appearance="outline">
                                    <input type="number" formControlName="npsSelfContribution" matInput
                                        placeholder="NPS - Own Contribution">
                                    <span matTextPrefix>₹&nbsp;</span>
                                    <mat-hint>Max - ₹ 50,000</mat-hint>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                    <br>
                    <div class="grid grid-cols-2">
                        <div class="flex flex-col mb-2">
                            <div class="">
                                <p class="font-bold">
                                    Other Deductions
                                </p>
                                <p>
                                    Education loan, medical Treatment, etc.
                                </p>

                            </div>
                            <div class="flex items-center dense-5">
                                <mat-form-field subscriptSizing="dynamic" appearance="outline">
                                    <input type="number" formControlName="otherDeductions" matInput placeholder="Other Deductions">
                                    <span matTextPrefix>₹&nbsp;</span>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="flex flex-col mb-2">
                            <div class="">
                                <p class="font-bold">
                                    Health Insurance
                                </p>
                                <p>
                                    Annual Premium
                                </p>

                            </div>
                            <div class="flex items-center dense-5">
                                <mat-form-field subscriptSizing="dynamic" appearance="outline">
                                    <input type="number" formControlName="medicalInsurance" matInput placeholder="Insurance">
                                    <span matTextPrefix>₹&nbsp;</span>
                                    <mat-hint>Max - ₹ 25,000</mat-hint>

                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                    <br>
                    <div class="flex justify-end">
                        <button mat-raised-button matStepperPrevious color="accent" class="mr-4">Back</button>
                        <button mat-raised-button matStepperNext color="primary"
                            (click)="calculate(taxForm.value)">Next</button>
                    </div>
                </mat-card-content>
            </mat-card>

        </mat-step>
        <mat-step label="Summary">
            <div class="grid grid-cols-2">
                <div class="chart-container mr-2">
                    <canvas baseChart class="chart" [data]="pieChartData" [type]="pieChartType"
                        [options]="pieChartOptions" [plugins]="pieChartPlugins">
                    </canvas>
                </div>
                <div class="flex flex-row pt-8 items-center">
                    <mat-card class="w-1/2 h-full mr-3"
                        [ngClass]="{'float-card': returnFormcontrolValue('totalOldTax') < returnFormcontrolValue('totalNewTax') }">
                        <mat-card-content>
                            <p class="font-bold underline text-center">
                                Old Tax Regime
                            </p>
                            <div class="flex flex-col">
                                <div class="mb-4">
                                    <p>
                                        Total Salary
                                    </p>
                                    <p class="font-bold">
                                        ₹ {{this.returnFormcontrolValue('netTaxableSalary')}}
                                    </p>
                                </div>
                                <div class="mb-4">
                                    <p>
                                        Total Deduction (80D)
                                    </p>
                                    <p class="font-bold">
                                        ₹
                                        {{this.returnFormcontrolValue('totalDeduction')+this.returnFormcontrolValue('standardDeduction')}}
                                    </p>
                                </div>
                                <div class="mb-4">
                                    <p>
                                        Total Excemption
                                    </p>
                                    <p class="font-bold">
                                        ₹ {{this.returnFormcontrolValue('exemptedHRA')}}
                                    </p>
                                </div>
                                <div class="mb-4">
                                    <p>
                                        Net Taxable Income
                                    </p>
                                    <p class="font-bold">
                                        ₹ {{this.returnFormcontrolValue('netTaxableIncome')}}
                                    </p>
                                </div>
                                <div class="mb-4">
                                    <p>
                                        Net Tax Payable
                                    </p>
                                    <p class="font-bold">
                                        <mat-chip-listbox aria-label="Net Tax Payable">
                                            <mat-chip-option class="pointer-event-none" selected>
                                                ₹ {{this.returnFormcontrolValue('totalOldTax')}}
                                            </mat-chip-option>
                                        </mat-chip-listbox>
                                    </p>
                                </div>
                                <button mat-raised-button color="primary" (click)="openDialogOldTax('old')">Tax
                                    Calculation Details</button>
                            </div>
                        </mat-card-content>
                    </mat-card>
                    <mat-divider vertical="true"></mat-divider>
                    <mat-card class="w-1/2 h-full"
                        [ngClass]="{'float-card': (returnFormcontrolValue('totalOldTax') > returnFormcontrolValue('totalNewTax')) }">

                        <mat-card-content>
                            <p class="font-bold underline text-center">
                                New Tax Regime
                            </p>
                            <div class="flex flex-col">
                                <div class="mb-4">
                                    <p>
                                        Total Salary
                                    </p>
                                    <p class="font-bold">
                                        ₹ {{this.returnFormcontrolValue('salaryIncome') +
                                        this.returnFormcontrolValue('netBusinessIncome')
                                        }}
                                    </p>
                                </div>
                                <div class="mb-4">
                                    <p>
                                        Total Deduction
                                    </p>
                                    <p class="font-bold">
                                        ₹ {{this.returnFormcontrolValue('standardDeduction') +
                                        this.returnFormcontrolValue('npsEmployerContribution')
                                        }}
                                    </p>
                                </div>
                                <div class="mb-4">
                                    <p>
                                        Total Excemption
                                    </p>
                                    <p class="font-bold">
                                        ₹ 0
                                    </p>
                                </div>
                                <div class="mb-4">
                                    <p>
                                        Net Taxable Income
                                    </p>
                                    <p class="font-bold">
                                        ₹ {{this.returnFormcontrolValue('salaryIncome') +
                                        this.returnFormcontrolValue('netBusinessIncome') -
                                        this.returnFormcontrolValue('npsEmployerContribution') -
                                        this.returnFormcontrolValue('standardDeduction')}}
                                    </p>
                                </div>
                                <div class="mb-4">
                                    <p>
                                        Net Tax Payable
                                    </p>
                                    <p class="font-bold">
                                        <mat-chip-listbox aria-label="Net Tax Payable">
                                            <mat-chip-option class="pointer-event-none" selected>
                                                ₹ {{this.returnFormcontrolValue('totalNewTax')}}
                                            </mat-chip-option>
                                        </mat-chip-listbox>
                                    </p>
                                </div>
                                <button mat-raised-button color="primary" (click)="openDialogNewTax('new')">Tax
                                    Calculation Details</button>
                            </div>
                        </mat-card-content>
                    </mat-card>
                </div>
            </div>
            <br><br>
            <h3 class="text-right">We recommend using <b>{{bestTaxRegime()}}</b> while filing Income Tax Return (ITR)
            </h3>
            <br>
            <div class="flex justify-end">
                <button mat-raised-button matStepperPrevious color="accent">Back</button>
            </div>
        </mat-step>
    </mat-stepper>
</form>